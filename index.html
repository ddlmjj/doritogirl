<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Autoclickeur Mobile — Cookie Clickeur (mobile only)</title>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">

  <style>
    :root{--bg:#071020;--card:#06101a;--accent:#ffd166;--muted:#94a3b8}
    *{box-sizing:border-box}
    
    body{margin:0; padding: 0;overflow-x: hidden;font-family:Inter,Segoe UI,Roboto,Arial;background-image: url("back.png");color:#e6eef6;display:flex;align-items:flex-start;justify-content:center;}
    @font-face {
      font-family: 'policedorito';
      src: url('font.woff2') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    /* Container mobile-first */
    .wrap{width:100%;max-width:480px;margin:12px 0;display:flex;flex-direction:column;gap:12px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));}

    .cookie-area{display:flex;flex-direction:column;align-items:center;justify-content:center;}
    .cookie-btn{width:78vw;max-width:340px;height:78vw;max-height:340px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .08s ease;-webkit-tap-highlight-color:transparent}
    .cookie-inner{font-size:48px;font-weight:700;color:#2b1500;text-shadow:0 1px 0 #fff7c2}

    .stats{margin-top:12px;text-align:center;color:white;}
    .big-num{font-size:22px;font-weight:700}
    .muted{color:var(--muted);font-size:13px}

    .upgrades{display:flex;flex-direction:column;gap:10px;margin-top:8px}
    .upgrade{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.03)}
    .row{display:flex;gap:8px;align-items:center}
    .buy-btn{background:linear-gradient(180deg,var(--accent),#ffb74d);background-image: url("corp.png");border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
    .buy-btn[disabled]{opacity:0.45;cursor:not-allowed}
    .small{font-size:13px;color:var(--muted)}

    .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px}
    .pill{padding:8px 10px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);font-size:14px;cursor:pointer;font-family: policedorito;}

    footer{margin-top:8px;font-size:13px;color:var(--muted);text-align:center}
    .upgrade.special {
      border: 1px solid gold;
      box-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
    }
    /* Overlay for non-mobile devices */
    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(0,0,0,0.7),rgba(0,0,0,0.85));color:#fff;padding:20px;z-index:9999}
    .overlay .box{max-width:560px;background:rgba(255,255,255,0.03);padding:18px;border-radius:12px;text-align:center}
    .overlay h2{margin:0 0 6px 0}
    .overlay p{margin:0 0 8px 0;color:#dfeefc}
    .menu-toggle {
      position: absolute;
      box-shadow:0 5px 10px rgba(0,0,0,0.5);
      top: 12px;
      left: 12px;
      background: #fff;
      border: none;
      border-radius: 10px;
      padding: 8px 10px;
      color: black;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      z-index: 10;
    }

    .menu-panel {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95); /* fond clair */
      color: #A8A8A8;
      backdrop-filter: blur(6px);
      padding: 20px;
      display: flex;
      flex-direction: column;
      transform: translateY(-100%);
      transition: transform 0.4s ease;
      z-index: 9;
      overflow-y: auto;
    }

    .menu-panel.open {
      transform: translateY(0);
    }

    .menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .close-menu {
      background: rgba(255,255,255,0.08);
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      color: #A8A8A8;
      cursor: pointer;
      font-size: 15px;
    }
    @media (min-width:900px){
      /* desktop: keep overlay but ensure background dim */
      .wrap{max-width:640px}
    }

    @keyframes tomber {
      0% {
        top: -28%;
        transform: rotate(-60deg);
      }
      90% {
        top: 30%;
        transform: rotate(360deg);
      }
      100% {
        top: 55%; 
        visibility: hidden;        
      }
    }
    .fall {
      animation: tomber 1s ease-in forwards;
    }
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <button class="menu-toggle" id="openMenu" aria-label="Ouvrir la boutique"><img id="cookieImgshop" src="shop.png" alt="Cookie" width="43.65" height="55.2" style="position: relative;"> <span style="position: absolute; left: 19%; top:65%;font-family: policedorito;">Shop</span>
 </button>
    <div class="card cookie-area" style="position: absolute; bottom: 0%">
       <div class="stats" style="position: absolute; top: -5%">
        <div class="big-num" id="cookiesDisplay" style="font-family: policedorito; font-size: 80px">0</div>
        <div class="muted">Dorito — <span id="cpsDisplay">0</span> / s • <span id="perClickDisplay">1</span> par clic</div>
      </div>
      <div class="cookie-btn" id="cookieBtn" aria-hidden="false" >
        <div class="cookie-inner" id="cookieInner" style="position: relative;"> 
            <img id="cookieImgstar" src="star.png" alt="Cookie" width="69" height="69" style="position: absolute; top: 17px; left: -30px; transform: rotate(-45deg);visibility:hidden">
            <img id="cookieImgdorito" src="dorito.png" alt="Cookie" width="63" height="71" style="position: absolute; top: 43.5%; left: 50%; transform: rotate(-90deg);">
            
          </div>
            
      </div>
      <div class="cookie-inner" id="cookieInnerdorito" style="position: relative;"> 
       
      <img id="cookieImg" src="corp.png" alt="Cookie" width="350" height="508" style="margin-top: -25%; margin-bottom: -4%" />
            <img id="cookieImgyeux" src="yeux.png" alt="Cookie" width="118" height="168" style="position: absolute; top: 6%; left: 37%; transform: rotate(-90deg);">
            <img id="cookieImgdoritopacket" src="dorito_packet.png" alt="Cookie" width="118" height="168" style="position: absolute; top: 60%; left: 40%;transform: rotate(5deg);">
            </div>
     

    
    </div>

    <div class="menu-panel" id="menuPanel">
      <div class="menu-header">
        <h2>Boutique</h2>
        <button class="close-menu" id="closeMenu">✕</button>
      </div>
      <div class="upgrades" id="upgradesList"></div>

      <div class="controls">
        <button class="pill" id="saveBtn">Sauvegarder</button>
        <button class="pill" id="resetBtn">Réinitialiser</button>
        
      </div>

    </div>
  </div>

  <div class="overlay" id="nonMobileOverlay" style="display:none">
    <div class="box">
      <h2>Version mobile uniquement</h2>
      <p>Ce jeu fonctionne uniquement sur téléphone (interface tactile). Ouvre cette page sur ton smartphone pour jouer.</p>
      <div style="margin-top:10px"><button class="pill" id="forceDesktopBtn">Forcer mode (développeur)</button></div>
    </div>
  </div>

  <script>
    // --- Détection mobile ---
    function detectMobile(){
      const ua = navigator.userAgent || '';
      const mobileUa = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
      const hasTouch = ('ontouchstart' in window) || (navigator.maxTouchPoints && navigator.maxTouchPoints > 0);
      const smallScreen = Math.max(window.innerWidth, window.innerHeight) <= 820; // include portrait/landscape
      return mobileUa || hasTouch || smallScreen;
    }

    let isMobile = detectMobile();
    const overlay = document.getElementById('nonMobileOverlay');
    const cookieBtn = document.getElementById('cookieBtn');

    function showNonMobile(){
      overlay.style.display = 'flex';
      // disable interactions
      cookieBtn.setAttribute('aria-hidden','true');
      cookieBtn.style.opacity = 0.35;
      document.getElementById('upgradesList').querySelectorAll('.buy-btn')?.forEach(b=>b.disabled=true);
      document.querySelectorAll('.pill').forEach(p=>p.disabled=true);
    }

    function hideNonMobile(){
      overlay.style.display = 'none';
      cookieBtn.setAttribute('aria-hidden','false');
      cookieBtn.style.opacity = 1;
      renderUpgrades();
      document.querySelectorAll('.pill').forEach(p=>p.disabled=false);
    }

    if (!isMobile){ showNonMobile(); }

    // allow forcing mode for dev/testing on desktop
    document.getElementById('forceDesktopBtn').addEventListener('click', ()=>{ isMobile = true; hideNonMobile(); });

    // --- Données de jeu ---
    const state = {
      cookies: 0,
      cps: 0,
      perClick: 1,
      specials: {
      criticalChance: 0,
      criticalMultiplier: 1,
      autoCollect: false,
      autoSaveEnabled: false,
      activeBoost: false
    },
      upgrades: [
        { id: 'autoclicker', name: 'Autoclickeur', baseCost: 50, qty: 0, cps: 1 },
        { id: 'grandma', name: 'Mémé', baseCost: 200, qty: 0, cps: 5 },
        { id: 'farm', name: 'Ferme à biscuits', baseCost: 2000, qty: 0, cps: 25 },
        { id: 'mine', name: 'Mine de chips', baseCost: 10000, qty: 0, cps: 120 },
        { id: 'factory', name: 'Méga-usine', baseCost: 50000, qty: 0, cps: 600 },
        { id: 'bank', name: 'Banque à cookies', baseCost: 300000, qty: 0, cps: 3200 },
        { id: 'temple', name: 'Temple croustillant', baseCost: 1200000, qty: 0, cps: 15000 },
        { id: 'wizard', name: 'Tour du magicien', baseCost: 10000000, qty: 0, cps: 90000 },
        { id: 'portal', name: 'Portail Dorito', baseCost: 25000000, qty: 0, cps: 400000 },
        { id: 'timeMachine', name: 'Machine temporelle', baseCost: 200000000, qty: 0, cps: 2500000 },
        { id: 'planet', name: 'Planète Dorito', baseCost: 2500000000, qty: 0, cps: 15000000 },
        { id: 'universe', name: 'Four cosmique', baseCost: 15000000000, qty: 0, cps: 85000000 },
        { id: 'b26', name: 'Citadelle Dorée', baseCost: 2e18, qty: 0, cps: 2e15 },
        { id: 'b27', name: 'Spire Infinie', baseCost: 8e18, qty: 0, cps: 9e15 },
        { id: 'b28', name: 'Tour des Âges', baseCost: 3e19, qty: 0, cps: 4e16 },
        { id: 'b29', name: 'Usine du Néant', baseCost: 1.2e20, qty: 0, cps: 1.6e17 },
        { id: 'b30', name: 'Cœur Temporel', baseCost: 4.5e20, qty: 0, cps: 6e17 },
        { id: 'b31', name: 'Nexus d’Énergie Pure', baseCost: 1.8e21, qty: 0, cps: 2.4e18 },
        { id: 'b32', name: 'Forge du Chaos', baseCost: 7.5e21, qty: 0, cps: 9e18 },
        { id: 'b33', name: 'Station Interdimensionnelle', baseCost: 3e22, qty: 0, cps: 3.6e19 },
        { id: 'b34', name: 'Moteur Céleste', baseCost: 1.2e23, qty: 0, cps: 1.4e20 },
        { id: 'b35', name: 'Anneau du Vide', baseCost: 5e23, qty: 0, cps: 6e20 },
        { id: 'b36', name: 'Monolithe Dorito', baseCost: 2.2e24, qty: 0, cps: 2.4e21 },
        { id: 'b37', name: 'Étoile Croustillante', baseCost: 9e24, qty: 0, cps: 1.1e22 },
        { id: 'b38', name: 'Chantier Galactique', baseCost: 4e25, qty: 0, cps: 4.5e22 },
        { id: 'b39', name: 'Forge Stellaire', baseCost: 1.6e26, qty: 0, cps: 1.8e23 },
        { id: 'b40', name: 'Atelier de l’Éternité', baseCost: 6.5e26, qty: 0, cps: 7.5e23 },
        { id: 'b41', name: 'Réseau d’Essence Pure', baseCost: 2.8e27, qty: 0, cps: 3e24 },
        { id: 'b42', name: 'Forge de l’Absolu', baseCost: 1.1e28, qty: 0, cps: 1.2e25 },
        { id: 'b43', name: 'Noyau de Réalité', baseCost: 4.7e28, qty: 0, cps: 5e25 },
        { id: 'b44', name: 'Spire Quantique', baseCost: 2e29, qty: 0, cps: 2e26 },
        { id: 'b45', name: 'Portail des Mondes', baseCost: 8e29, qty: 0, cps: 8e26 },
        { id: 'b46', name: 'Ancre du Multivers', baseCost: 3.5e30, qty: 0, cps: 3e27 },
        { id: 'b47', name: 'Forge d’Antimatière', baseCost: 1.5e31, qty: 0, cps: 1.2e28 },
        { id: 'b48', name: 'Tour de Convergence', baseCost: 6e31, qty: 0, cps: 5e28 },
        { id: 'b49', name: 'Fonderie Cosmique', baseCost: 2.5e32, qty: 0, cps: 2e29 },
        { id: 'b50', name: 'Atelier de Résonance', baseCost: 1e33, qty: 0, cps: 8e29 },
        { id: 'b51', name: 'Bastion du Vide', baseCost: 4e33, qty: 0, cps: 3.5e30 },
        { id: 'b52', name: 'Sanctuaire Dorito', baseCost: 1.8e34, qty: 0, cps: 1.5e31 },
        { id: 'b53', name: 'Forge de l’Aube', baseCost: 7.5e34, qty: 0, cps: 6e31 },
        { id: 'b54', name: 'Couronne des Titans', baseCost: 3e35, qty: 0, cps: 2.5e32 },
        { id: 'b55', name: 'Noyau Primordial', baseCost: 1.2e36, qty: 0, cps: 1e33 },
        { id: 'b56', name: 'Tour de Lumière', baseCost: 5e36, qty: 0, cps: 4e33 },
        { id: 'b57', name: 'Forge des Mondes Perdus', baseCost: 2e37, qty: 0, cps: 1.7e34 },
        { id: 'b58', name: 'Citadelle du Temps', baseCost: 8e37, qty: 0, cps: 7e34 },
        { id: 'b59', name: 'Puits d’Éternité', baseCost: 3.2e38, qty: 0, cps: 3e35 },
        { id: 'b60', name: 'Cœur Universel', baseCost: 1.3e39, qty: 0, cps: 1.3e36 },
        { id: 'b61', name: 'Forge des Origines', baseCost: 5.5e39, qty: 0, cps: 5.5e36 },
        { id: 'b62', name: 'Arche du Néant', baseCost: 2.5e40, qty: 0, cps: 2.5e37 },
        { id: 'b63', name: 'Pilier de l’Infini', baseCost: 1e41, qty: 0, cps: 1.1e38 },
        { id: 'b64', name: 'Sphère de Création', baseCost: 4.5e41, qty: 0, cps: 4.5e38 },
        { id: 'b65', name: 'Trône Cosmique', baseCost: 2e42, qty: 0, cps: 2e39 },

        // --- Boosts de clics ---
        { id: 'click1', name: 'Doigt énergique', baseCost: 15, qty: 0, clickBoost: 1 },
        { id: 'click2', name: 'Ongle renforcé', baseCost: 100, qty: 0, clickBoost: 2 },
        { id: 'click3', name: 'Doigt turbo', baseCost: 500, qty: 0, clickBoost: 5 },
        { id: 'click4', name: 'Main robotique', baseCost: 2500, qty: 0, clickBoost: 10 },
        { id: 'click5', name: 'Gant d’or', baseCost: 10000, qty: 0, clickBoost: 20 },
        { id: 'click6', name: 'Bras bionique', baseCost: 50000, qty: 0, clickBoost: 50 },
        { id: 'click7', name: 'Main divine', baseCost: 250000, qty: 0, clickBoost: 120 },
        { id: 'click8', name: 'Toucher cosmique', baseCost: 1200000, qty: 0, clickBoost: 400 },
        { id: 'click9', name: 'Clic quantique', baseCost: 8000000, qty: 0, clickBoost: 1000 },
        { id: 'click10', name: 'Clic du néant', baseCost: 50000000, qty: 0, clickBoost: 3000 },

        // --- Objets spéciaux (petits bonus à effet global) ---
        { id: 'cookieMine', name: 'Gisement sucré', baseCost: 75000, qty: 0, cps: 2000, clickBoost: 5 },
        { id: 'boosterChip', name: 'Puce Dorito', baseCost: 1000000, qty: 0, cps: 15000, clickBoost: 10 },
        { id: 'quantumOven', name: 'Four quantique', baseCost: 25000000, qty: 0, cps: 200000, clickBoost: 25 },
        { id: 'nexus', name: 'Nexus croustillant', baseCost: 100000000, qty: 0, cps: 1500000, clickBoost: 40 },

        // --- Objets spéciaux à effet unique ---
        { id: 'goldenOven', name: 'Four Doré', baseCost: 15000, qty: 0, special: 'doubleGrandma' },
        { id: 'sacredBook', name: 'Livre Sacré du Cookie', baseCost: 100000, qty: 0, special: 'doubleClickPower' },
        { id: 'cookieStorm', name: 'Tempête de Cookies', baseCost: 500000, qty: 0, special: 'bonusTemporaire' },
        { id: 'darkPortal', name: 'Portail Obscur', baseCost: 2500000, qty: 0, special: 'doubleCps' },
        { id: 'timeReverser', name: 'Inverseur du Temps', baseCost: 20000000, qty: 0, special: 'slowBonusDecay' },
        { id: 'sp1', name: 'Main Dorée', baseCost: 50000, qty: 0, special: 'x5Click' },
        { id: 'sp2', name: 'Gant du Cookie', baseCost: 150000, qty: 0, special: 'autoClick' },
        { id: 'sp3', name: 'Horloge Sucrée', baseCost: 400000, qty: 0, special: 'speedBoost' },
        { id: 'sp4', name: 'Bocal à Énergie', baseCost: 1e6, qty: 0, special: 'regenOverTime' },
        { id: 'sp5', name: 'Cristal Dorito', baseCost: 3e6, qty: 0, special: 'criticalClicks' },
        { id: 'sp6', name: 'Lunettes à Cookies', baseCost: 1.2e7, qty: 0, special: 'showHiddenBonus' },
        { id: 'sp7', name: 'Boussole Dorée', baseCost: 4e7, qty: 0, special: 'autoCollectStorm' },
        { id: 'sp8', name: 'Catalyseur Croustillant', baseCost: 1e8, qty: 0, special: 'multiplyAllBy2' },
        { id: 'sp9', name: 'Essence du Vide', baseCost: 5e8, qty: 0, special: 'permanentBoost' },
        { id: 'sp10', name: 'Horloge Inversée', baseCost: 2e9, qty: 0, special: 'slowTime' },
        { id: 'sp11', name: 'Totem Dorito', baseCost: 1e10, qty: 0, special: 'doubleBuildings' },
        { id: 'sp12', name: 'Cœur de Sucre', baseCost: 5e10, qty: 0, special: 'healOverTime' },
        { id: 'sp13', name: 'Boîte Mystère', baseCost: 2e11, qty: 0, special: 'randomEffect' },
        { id: 'sp14', name: 'Portail d’Abondance', baseCost: 8e11, qty: 0, special: 'instantBonus' },
        { id: 'sp15', name: 'Larme du Temps', baseCost: 3e12, qty: 0, special: 'resetBonus' },
        { id: 'sp16', name: 'Grimoire des Douze Clics', baseCost: 1.5e13, qty: 0, special: 'comboClick' },
        { id: 'sp17', name: 'Cube Infini', baseCost: 5e13, qty: 0, special: 'infiniteBoost' },
        { id: 'sp18', name: 'Âme Dorée', baseCost: 2e14, qty: 0, special: 'rebirthBonus' },
        { id: 'sp19', name: 'Machine à Goûter le Temps', baseCost: 1e15, qty: 0, special: 'timeWarp' },
        { id: 'sp20', name: 'Œil Suprême', baseCost: 5e15, qty: 0, special: 'allReveal' }

      ]
    };

    // --- Références DOM ---
    const cookiesDisplay = document.getElementById('cookiesDisplay');
    const cpsDisplay = document.getElementById('cpsDisplay');
    const perClickDisplay = document.getElementById('perClickDisplay');
    const upgradesList = document.getElementById('upgradesList');
    const saveBtn = document.getElementById('saveBtn');
    const resetBtn = document.getElementById('resetBtn');
    const autobuyCheckbox = document.getElementById('autobuyCheckbox');
    const clickSound = new Audio("dorito_sound.webm");
    const menuPanel = document.getElementById('menuPanel');
    const openMenu = document.getElementById('openMenu');
    const closeMenu = document.getElementById('closeMenu');
    clickSound.volume = 0.5;

    // --- Utilitaires ---
    function format(n){
      if (n < 10000) return Math.floor(n).toLocaleString();
      const units = ['k','M','G','T'];
      let i = -1; let v = n;
      while(v >= 1000 && i < units.length-1){ v /= 1000; i++; }
      return v.toFixed( (v<10 && i>=0)?1:0 ) + units[i];
    }

    function costFor(upg){ return Math.round(upg.baseCost * Math.pow(1.15, upg.qty)); }
    const achievements = [
      { id: 'firstClick', condition: () => state.cookies >= 1, name: 'Premier clic' },
      { id: 'rich', condition: () => state.cookies >= 10000, name: '10 000 cookies !' },
      { id: 'army', condition: () => state.upgrades.find(u => u.id === 'grandma')?.qty >= 10, name: '10 mémés' },
      { id: 'bigarmy', condition: () => state.upgrades.find(u => u.id === 'grandma')?.qty >= 100, name: '100 mémés' },
      { id: 'veryrich', condition: () => state.cookies >= 1000000000, name: '1 000 000 000 cookies !' }
    ];

    const notifContainer = document.createElement('div');
    notifContainer.id = 'notifContainer';
    notifContainer.style.position = 'fixed';
    notifContainer.style.bottom = '20px';
    notifContainer.style.right = '20px';
    notifContainer.style.display = 'flex';
    notifContainer.style.flexDirection = 'column';
    notifContainer.style.gap = '10px';
    notifContainer.style.zIndex = '9999';
    document.body.appendChild(notifContainer);

    // --- fonction pour afficher une notif stylisée
    function showNotification(text) {
      const notif = document.createElement('div');
      notif.className = 'notif';
      notif.innerHTML = `🏆 <strong>${text}</strong>`;
      
      Object.assign(notif.style, {
        background: 'linear-gradient(135deg, #ffcf4d, #ff9f1c)',
        color: '#2b1500',
        padding: '10px 16px',
        borderRadius: '12px',
        boxShadow: '0 4px 12px rgba(0,0,0,0.3)',
        fontFamily: 'policedorito, sans-serif',
        fontSize: '16px',
        transform: 'translateX(120%)',
        opacity: '0',
        transition: 'all 0.4s ease'
      });

      notifContainer.appendChild(notif);

      // Animation d’apparition
      requestAnimationFrame(() => {
        notif.style.transform = 'translateX(0)';
        notif.style.opacity = '1';
      });

      // Disparaît après 4 secondes
      setTimeout(() => {
        notif.style.transform = 'translateX(120%)';
        notif.style.opacity = '0';
        setTimeout(() => notif.remove(), 400);
      }, 4000);
    }

    // --- fonction d’achievements avec notif
    function checkAchievements() {
      achievements.forEach(a => {
        if (!a.unlocked && a.condition()) {
          a.unlocked = true;
          showNotification(`Succès débloqué : ${a.name}`);
        }
      });
    }

    function recalcState() {
      state.cps = 0;
      state.perClick = 1;
      const multipliers = {};

      // détecter les multiplicateurs
      state.upgrades.forEach(u => {
        if (u.multiplier && u.qty > 0) {
          multipliers[u.multiplier.target] = (multipliers[u.multiplier.target] || 1) * u.multiplier.factor;
        }
      });

      // appliquer la prod normale
      state.upgrades.forEach(u => {
        if (u.cps) {
          const factor = multipliers[u.id] || 1;
          state.cps += u.cps * u.qty * factor;
        }
        if (u.clickBoost) state.perClick += u.clickBoost * u.qty;
      });
    }


    function renderUpgrades(){
      upgradesList.innerHTML = '';
      state.upgrades.forEach(u => {
        

        const div = document.createElement('div');
        div.className = 'upgrade';
        div.innerHTML = `\n          <div>\n            <div style="font-weight:700">${u.name} <span class="small" style="font-weight:400">x${u.qty}</span></div>\n            <div class="small">${u.cps ? u.cps + ' /s' : (u.clickBoost ? '+'+u.clickBoost+' par clic' : '')}</div>\n          </div>\n          <div class="row">\n            <div style="text-align:right;margin-right:8px">\n              <div class="small">Coût</div>\n              <div style="font-weight:700">${format(costFor(u))}</div>\n            </div>\n            <button class="buy-btn" ${(!isMobile || (state.cookies < costFor(u)) || (u.special && u.qty === 1))  ? 'disabled' : ''} data-id="${u.id}">Acheter</button>\n          </div>\n        `;
        upgradesList.appendChild(div);
        if (u.special) div.classList.add('special');
      });

      cookiesDisplay.textContent = format(state.cookies);
      cpsDisplay.textContent = format(state.cps);
      perClickDisplay.textContent = format(state.perClick);
      

      // attach listeners safe (re-attach after render)
      upgradesList.querySelectorAll('.buy-btn').forEach(btn => {
        btn.onclick = () => { if (isMobile) buyUpgrade(btn.dataset.id); };
        // touch support
        btn.addEventListener('touchstart', (e)=>{ e.preventDefault(); if (isMobile) buyUpgrade(btn.dataset.id); });
      });
    }


    function applySpecialEffect(id) {
      switch (id) {
        case 'goldenOven':
          // Double les mémés
          const grandma = state.upgrades.find(u => u.id === 'grandma');
          if (grandma) grandma.cps *= 2;
          showNotification('🔥 Les Mémés produisent 2x plus de cookies !');
          break;

        case 'sacredBook':
          // Double les clics
          state.perClick *= 2;
          showNotification('📖 Tes clics valent 2x plus !');
          break;

        case 'cookieStorm':
          // Bonus temporaire de 30s
          if (window.cookieStormActive) return; // pas cumulable
          window.cookieStormActive = true;
          const oldCps = state.cps*2 ;
          const oldClick = state.perClick*2;
          state.cps *= 3;
          state.perClick *= 3;
          showNotification('🌩 Tempête de cookies ! +300% pendant 30s !');
          renderUpgrades();
          setTimeout(() => {
            state.cps -= oldCps;
            state.perClick -= oldClick;
            window.cookieStormActive = false;
            showNotification('🌦 La tempête s’apaise...');
          }, window.bonusDuration || 30000);
          break;

        case 'darkPortal':
          // Double tous les CPS
          state.upgrades.forEach(u => {
            if (u.cps) u.cps *= 2;
          });
          showNotification('🌀 Tous tes bâtiments produisent 2x plus !');
          break;

        case 'timeReverser':
          // Allonge la durée des bonus temporaires
          window.bonusDuration = 60000;
          showNotification('⏳ Les effets durent désormais 2x plus longtemps !');
          break;
      case 'sp1': // Main Dorée
        state.perClick *= 5;
        showNotification('🖐️ Tes clics valent 5x plus !');
        break;

      case 'sp2': // Gant du Cookie
        showNotification('🤖 Clic automatique activé !');
        setInterval(() => clickCookie(), 1000);
        break;

      case 'sp3': // Horloge Sucrée
        state.cps *= 1.5;
        showNotification('⏰ +50% de vitesse de production !');
        break;

      case 'sp4': // Bocal à Énergie
        showNotification('⚡ Régénération lente de cookies activée !');
        setInterval(() => { state.cookies += state.cps * 0.05; renderUpgrades(); }, 3000);
        break;

      case 'sp5': // Cristal Dorito
        state.specials.criticalChance = 0.05;
        state.specials.criticalMultiplier = 10;
        if (!restoreMode) showNotification('💥 Clics critiques activés !');
        break;
      

      case 'sp6': // Lunettes à Cookies
        showNotification('👓 Tu vois les bonus cachés (à venir) !');
        break;

      case 'sp7': // Boussole Dorée
       
        state.specials.autoCollect = true;
        if (!restoreMode) showNotification('👻 Auto-collect activé !');
        break;

      case 'sp8': // Catalyseur Croustillant
        state.cps *= 2;
        state.perClick *= 2;
        showNotification('✨ Tout est 2x plus rapide !');
        break;

      case 'sp9': // Essence du Vide
        state.cps *= 3;
        state.perClick *= 3;
        showNotification('🌌 Puissance cosmique x3 permanente !');
        break;

      case 'sp10': // Horloge Inversée
        showNotification('⏳ Le temps coule plus lentement...');
        window.gameSpeed = 0.5;
        break;

      case 'sp11': // Totem Dorito
        state.upgrades.forEach(u => { if (u.cps) u.cps *= 2; });
        showNotification('🗿 Tous tes bâtiments produisent 2x plus !');
        break;

      case 'sp12': // Cœur de Sucre
        showNotification('💖 +1% de cookies toutes les 2s en soin passif.');
        setInterval(() => { state.cookies *= 1.01; renderUpgrades(); }, 2000);
        break;

      case 'sp13': // Boîte Mystère
        const effects = ['x5Click', 'doubleBuildings', 'instantBonus', 'regenOverTime'];
        const rand = effects[Math.floor(Math.random() * effects.length)];
        applySpecialEffect(rand);
        showNotification('🎁 Un effet mystère t’a été offert !');
        break;

      case 'sp14': // Portail d’Abondance
        const bonus = state.cps * 100;
        state.cookies += bonus;
        showNotification(`💫 +${format(bonus)} cookies instantanés !`);
        break;

      case 'sp15': // Larme du Temps
        showNotification('💧 Réinitialisation douce... tout est boosté de 10% !');
        state.upgrades.forEach(u => { if (u.cps) u.cps *= 1.1; });
        state.perClick *= 1.1;
        break;

      case 'sp16': // Grimoire des Douze Clics
        showNotification('📖 Combo activé ! Chaque 12e clic donne 10x plus.');
        window.comboClicks = 0;
        const oldClicky = clickCookie;
        clickCookie = function() {
          window.comboClicks++;
          if (window.comboClicks % 12 === 0) state.cookies += state.perClick * 9;
          oldClicky();
        };
        break;

      case 'sp17': // Cube Infini
        showNotification('🔷 Tous les gains augmentent de 1% chaque seconde !');
        setInterval(() => {
          state.cps *= 1.01;
          state.perClick *= 1.01;
          renderUpgrades();
        }, 1000);
        break;

      case 'sp18': // Âme Dorée
        showNotification('🌠 Tu ressuscites plus fort : +100% CPS permanent !');
        state.cps *= 2;
        break;

      case 'sp19': // Machine à Goûter le Temps
        showNotification('🕰 Accélération temporelle ! +400% pendant 15s');
        const oldCpsy = state.cps, oldClick2 = state.perClick;
        state.cps *= 5; state.perClick *= 5;
        renderUpgrades();
        setTimeout(() => { state.cps = oldCpsy; state.perClick = oldClick2; renderUpgrades(); }, 15000);
        break;

      
  


      }
    }
    function buyUpgrade(id){
      console.log("hello")
      const u = state.upgrades.find(x => x.id === id);
      const cost = costFor(u);
      if (u.special) {
        if (u.qty < 1) {
        applySpecialEffect(u.id);
        if (state.cookies >= cost){ state.cookies -= cost; u.qty += 1; recalcState(); renderUpgrades(); }
        }
      } else {
        if (state.cookies >= cost){ state.cookies -= cost; u.qty += 1; recalcState(); renderUpgrades(); }
      }
    }
    function create_dorito() { 
      const nombreAleatoire = Math.floor(Math.random() * 100) + 1;

      const img = document.createElement('img');
      
      img.src = nombreAleatoire === 56 ? 'bochi.png' : 'dorito.png';
      img.alt = 'Cookie';
      img.width = 63;
      img.height = 71;
      img.className = 'fall';
      img.id = 'cookieImgdoritoclone';
      img.style.position = 'absolute';
      img.style.top = '53.5%';
      img.style.left = '50%';
      img.style.transform = 'rotate(-90deg)';

      // Ajoute l'image à la page
      document.getElementById("cookieInnerdorito").appendChild(img);
       img.addEventListener('animationend', () => {
        img.remove();
      });}
    // --- Click handling (mobile-first) ---
    function clickCookie(){ 
          if (!isMobile) return; 
          let gain = state.perClick;

      // Clic critique ?
      if (window.criticalChance && Math.random() < window.criticalChance) {
        gain *= window.criticalMultiplier || 10;
        showNotification('💥 CLIC CRITIQUE !');
      }

      
      

      state.cookies += gain;
      clickSound.currentTime = 0; 
      clickSound.play(); 
      document.getElementById("cookieImgstar").style.visibility = "visible"; 
      sleep(75).then(() => { document.getElementById("cookieImgstar").style.visibility = "hidden"; checkAchievements()}); 
    create_dorito()
    animateCookie(); renderUpgrades(); }

    // use touchstart for responsiveness, fallback to click
    cookieBtn.addEventListener('touchstart', (e)=>{ e.preventDefault(); clickCookie(); });
    cookieBtn.addEventListener('click', (e)=>{ if (isMobile) clickCookie(); });
    function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}
    // --- Passive income tick ---
    let count = 0
    setInterval(() => {
      if (!isMobile) return; // only when mobile
     
      state.cookies += state.cps / 1; // each second
      count += 1
      let yeux = document.getElementById("cookieImgyeux")
      
      if(count%6 === 0) {
        if(yeux.src.endsWith("yeux.png")) {
            yeux.src = "yeux3.png"
            sleep(125).then(() => { yeux.src = "yeux.png" });

        } else {
           yeux.src = "yeux.png"
        }
      } else if (count%20 === 0){
        yeux.src = "yeux2.png"
        sleep(500).then(() => { yeux.src = "yeux.png" });
      }
      // auto-buy if enabled
      
      renderUpgrades();
    }, 1000);

    // --- Animations ---
    function animateCookie(){
      cookieBtn.animate([
        { transform: 'scale(1)' },
        { transform: 'scale(0.96)' },
        { transform: 'scale(1)' }
      ],{ duration: 110, easing: 'ease-out' });
    }

    // --- Sauvegarde / Chargement ---
    function save() {
      const toSave = {
        cookies: state.cookies,
        upgrades: state.upgrades.map(u => ({ id: u.id, qty: u.qty })),
        specials: state.specials
      };
      localStorage.setItem('miniCookieSave_mobile_v1', JSON.stringify(toSave));
      flashSave();
    }


    function load() {
      const raw = localStorage.getItem('miniCookieSave_mobile_v1');
      if (!raw) return;

      try {
        const data = JSON.parse(raw);
        state.cookies = data.cookies || 0;
        if (data.upgrades) {
          data.upgrades.forEach(savedUpg => {
            const u = state.upgrades.find(x => x.id === savedUpg.id);
            if (u) u.qty = savedUpg.qty || 0;
          });
        }

        if (data.specials) {
          state.specials = data.specials; // ✅ restauration des effets persistants
        }

        recalcState();
        reapplySpecials();

      } catch (e) {
        console.warn('Erreur lors du chargement de la sauvegarde', e);
      }
    }
    function reapplySpecials() {
      if (state.specials.criticalChance > 0) {
        showNotification('💥 Clics critiques actifs !');
      }
      if (state.specials.autoCollect) {
        showNotification('👻 Auto-collect actif !');
      }
      if (state.specials.autoSaveEnabled) {
        showNotification('👑 Sauvegarde automatique active !');
      }
      if (state.specials.activeBoost) {
        document.body.classList.add('active-boost');
      }
    }

    function flashSave(){ saveBtn.textContent = 'Sauvé ✓'; setTimeout(()=> saveBtn.textContent = 'Sauvegarder', 900); }
    openMenu.onclick = () => {menuPanel.classList.add('open'); openMenu.style.visibility = "hidden"}
    closeMenu.onclick = () => {menuPanel.classList.remove('open'); openMenu.style.visibility = "visible"}
    saveBtn.addEventListener('click', ()=>{ if (isMobile) save(); });
    resetBtn.addEventListener('click', ()=>{ if (!isMobile) return; if (!confirm('Réinitialiser la partie ?')) return; localStorage.removeItem('miniCookieSave_mobile_v1'); state.cookies = 0; state.upgrades.forEach(u=>u.qty=0); recalcState(); renderUpgrades(); });

    // auto-save régulière (mobile uniquement)
    setInterval(()=>{ if (isMobile) save(); }, 5000);

    // init
    load(); recalcState(); renderUpgrades();

    // === BONUS DORITO VOLANT ===

    // paramètres du bonus
    const BONUS_DURATION = 30000; // 30 secondes
    const BONUS_MULTIPLIER = 2; // double la production
    const BONUS_SPAWN_INTERVAL = 10000; // apparaît toutes les 60 sec

    let bonusActive = false;
    let bonusElement = null;
    let bonusVelocity = { x: 1, y: 1 };
    let bonusAngle = 0;
    let bonusAnim;

    // fonction qui active le bonus
    function activateBonus() {
      if (bonusActive) return;
      bonusActive = true;

      state.perClick *= BONUS_MULTIPLIER;
      state.cps *= BONUS_MULTIPLIER;

      // petit effet visuel
      const overlay = document.createElement('div');
      overlay.textContent = "🔥 BONUS ×2 ACTIVÉ !";
      Object.assign(overlay.style, {
        position: 'fixed',
        top: '20px',
        left: '50%',
        transform: 'translateX(-50%)',
        background: 'linear-gradient(135deg, #ffcf4d, #ff9f1c)',
        color: '#2b1500',
        padding: '10px 20px',
        borderRadius: '12px',
        fontFamily: 'policedorito, sans-serif',
        fontWeight: '700',
        fontSize: '18px',
        zIndex: 9999,
        boxShadow: '0 4px 12px rgba(0,0,0,0.3)',
        transition: 'opacity 0.5s ease'
      });
      document.body.appendChild(overlay);
      setTimeout(() => { overlay.style.opacity = '0'; setTimeout(() => overlay.remove(), 500); }, 3000);

      // désactiver le bonus après un délai
      setTimeout(() => {
        state.perClick /= BONUS_MULTIPLIER;
        state.cps /= BONUS_MULTIPLIER;
        bonusActive = false;
      }, BONUS_DURATION);
    }

    // création du bonus visuel
    function spawnBonus() {
      if (bonusElement) return; // éviter plusieurs à la fois

      bonusElement = document.createElement('img');
      bonusElement.src = 'bonus_dorito.png'; // ton image (mets le fichier dans ton dossier)
      bonusElement.alt = 'Bonus Dorito';
      bonusElement.width = 64;
      bonusElement.height = 64;
      bonusElement.style.position = 'fixed';
      bonusElement.style.top = Math.random() * (window.innerHeight - 100) + 'px';
      bonusElement.style.left = Math.random() * (window.innerWidth - 100) + 'px';
      bonusElement.style.cursor = 'pointer';
      bonusElement.style.zIndex = 9998;
      bonusElement.style.transition = 'transform 0.1s linear';
      document.body.appendChild(bonusElement);

      bonusVelocity = { x: (Math.random() * 3 + 1) * (Math.random() < 0.5 ? -1 : 1),
                        y: (Math.random() * 3 + 1) * (Math.random() < 0.5 ? -1 : 1) };

      // clic = active bonus
      bonusElement.addEventListener('click', () => {
        activateBonus();
        destroyBonus();
      });

      moveBonus();
    }

    // mouvement du bonus (rebond + rotation)
    // --- Variables globales du bonus ---
    let bonusX = Math.random() * (window.innerWidth - 100);
    let bonusY = Math.random() * (window.innerHeight - 100);
    let senstourne = 1

    // --- Fonction de déplacement corrigée ---
    function moveBonus() {
      if (!bonusElement) return;

      // mise à jour de la position
      bonusX += bonusVelocity.x;
      bonusY += bonusVelocity.y;

      // rebonds horizontaux
      if (bonusX <= 0) {
        bonusX = 0;
        bonusVelocity.x *= -1;
        senstourne = senstourne*-1
      } else if (bonusX + bonusElement.width >= window.innerWidth) {
        bonusX = window.innerWidth - bonusElement.width;
        bonusVelocity.x *= -1;
        senstourne = senstourne*-1
      }

      // rebonds verticaux
      if (bonusY <= 0) {
        bonusY = 0;
        bonusVelocity.y *= -1;
        senstourne = senstourne*-1
      } else if (bonusY + bonusElement.height >= window.innerHeight) {
        bonusY = window.innerHeight - bonusElement.height;
        bonusVelocity.y *= -1;
        senstourne = senstourne*-1
      }

      // rotation douce

      bonusAngle += 2*senstourne;
      if (bonusAngle >= 360) bonusAngle -= 360;

      // appliquer position et rotation
      bonusElement.style.left = bonusX + "px";
      bonusElement.style.top = bonusY + "px";
      bonusElement.style.transform = `rotate(${bonusAngle}deg)`;

      // prochaine frame
      bonusAnim = requestAnimationFrame(moveBonus);
    }


    // détruire le bonus après 10 sec s’il n’est pas cliqué
    function destroyBonus() {
      if (!bonusElement) return;
      cancelAnimationFrame(bonusAnim);
      bonusElement.remove();
      bonusElement = null;
    }

    // générer un bonus toutes les X secondes
    setInterval(() => {
      if (!bonusActive && !bonusElement) spawnBonus();
      setTimeout(destroyBonus, 10000); // il disparaît après 10 secondes
    }, BONUS_SPAWN_INTERVAL);







    // handle orientation/resize changes to re-evaluate mobile detection
    let resizeTimer;
    window.addEventListener('resize', ()=>{ clearTimeout(resizeTimer); resizeTimer = setTimeout(()=>{ const newMobile = detectMobile(); if (newMobile !== isMobile){ isMobile = newMobile; if (!isMobile) showNonMobile(); else hideNonMobile(); } }, 250); });
  </script>
</body>
</html>